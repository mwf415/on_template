<!DOCTYPE html>
<html lang="en">

<head>
    <title>${globalConfig.mallName!}-商家入驻</title>
    [#include "../../includes/common.html"]
    <script src="${res}/lib/crypto/rollups/tripledes.js "></script>
    <script src="${res}/lib/crypto/components/mode-ecb.js"></script>
    <script src="${res}/js/login.js"></script>
    <script src="${res}/js/components/upload.js"></script>
    <script src="${res}/lib/moment.js"></script>
</head>

<body>
    <!-- 顶部导航栏 -->
    [#include "../../includes/topBar.html"]
    <!-- 头部 -->
    <div class="header head-shadow-slim">
        <div class="senter-head">
            <div class="senter-left">
                [#assign name="商家入驻"]
                [#include "../../includes/logo.html"]
            </div>
            <div class="senter-right">
                <a class="senter-right__tab senter-right__tab--active" href="#">首页</a>
                <a class="senter-right__tab" href="#">入驻流程</a>
                <a class="senter-right__tab" href="#">入驻协议</a>
                <a class="senter-right__tab tab-last" href="#">商家帮助</a>
            </div>
        </div>
    </div>
    <!-- 主体 -->
    <div class="senter-body" id="main" v-cloak>
        <div class="container senter-inner ">
            <!-- 主体头部 -->
            <ul class="senter-inner__head" style="overflow:hidden;">
                <li class="senter-inner__tab senter-inner__tab--active senter-inner__tab--visited">
                    <span class=""><i class="fa fa-home senter-inner__fa"></i></span>
                    店铺选择
                    <span class=""><i class="fa fa-angle-right senter-inner__right"></i></span>
                </li>
                <li class="senter-inner__tab senter-inner__tab--active senter-inner__tab--visited">
                    <span class=""><i class="fa fa-file-text-o senter-inner__fa"></i></span>
                    签订入住协议
                    <span class=""><i class="fa fa-angle-right senter-inner__right"></i></span>
                </li>
                <li style="padding-left:40px;" class="senter-inner__tab senter-inner__tab--active" :class="[personStage=='店铺信息'?'senter-inner__tab--visited':'']">
                    <span class=""><i class="fa fa-user-o senter-inner__fa"></i></span>
                    <span v-if="storeType==1">个人信息认证</span><span v-if="storeType==2">企业信息认证</span>
                    <span class=""><i class="fa fa-angle-right senter-inner__right"></i></span>
                </li>
                <li class="senter-inner__tab" :class="[personStage=='店铺信息'?'senter-inner__tab--active':'']">
                    <span class=""><i class="fa fa-home senter-inner__fa"></i></span>
                    店铺信息认证
                    <span class=""><i class="fa fa-angle-right senter-inner__right"></i></span>
                </li>
                <li class="senter-inner__tab">
                    <span class=""><i class="fa fa-calendar-check-o senter-inner__fa"></i></span>
                    等待审核
                </li>
            </ul>
            <!-- 主体身体 -->
            <div class="senter-con">
                <div class="senter-identify">
                    <!-- 个人提示 -->
                    <div v-show="storeType==1">
                        <!-- 个人信息 -->
                        <h3 class="senter-identify__title" v-show="personStage=='个人信息'">个人信息</h3>
                        <!-- 店铺信息 -->
                        <h3 class="senter-identify__title" v-show="personStage=='店铺信息'">店铺信息认证</h3>
                    </div>
                    <!-- 公司提示 -->
                    <div v-show="storeType==2">
                        <!-- 公司信息 -->
                        <h3 class="senter-identify__title" v-show="companyStage=='公司信息'">公司信息</h3>
                        <!-- 店铺信息 -->
                        <h3 class="senter-identify__title" v-show="companyStage=='店铺信息'">店铺信息认证</h3>
                    </div>
                </div>
                <div class="senter-ebody">
                    <div class="senter-esinfo">
                        <el-form size="mini" label-position="right" label-width="150px" :model="formSubmitData" :rules="rules"
                            ref="form">
                            <!-- 个人表单 -->
                            <div v-if="storeType==1">
                                <!-- 个人信息 -->
                                <div v-show="personStage=='个人信息'">
                                    <!-- 基本信息 -->
                                    <h3 class="senter-esinfo__title">基本信息</h3>
                                    <div class="senter-esinfo__body">
                                        <el-form-item label="店铺类型">
                                            <span class="store-person">个人店铺</span>
                                        </el-form-item>
                                        <el-form-item class="is-required" label="联系人姓名" prop="contactName">
                                            <!-- 联系人姓名 -->
                                            <el-input class="add__w300 add__w350" placeholder="确保与身份证上姓名一致" v-model="formSubmitData.contactName"></el-input>
                                            <span class="input-info">
                                            </span>
                                        </el-form-item>
                                        <el-form-item class="is-required" label="联系人手机" prop="contactMobile">
                                            <!-- 联系人电话 -->
                                            <el-input v-model="formSubmitData.contactMobile" placeholder="可用于登录商家平台，请填写常用联系手机"></el-input>
                                            <span class="input-info"></span>
                                        </el-form-item>
                                        <el-form-item class="is-required" label="联系人邮箱" prop="contactMail">
                                            <!-- 邮箱 -->
                                            <el-input v-model="formSubmitData.contactMail"></el-input>
                                        </el-form-item>
                                        <el-form-item class="companyLoaction" label="所在地" prop="storeInfo.areaName">
                                            <!-- 省市县 -->
                                            <cms-area-select class="verifyid-m-select" @change="getAreaInfo" :data="areaData"></cms-area-select>
                                            <span class="input-info input-info2">显示在商城店铺，请准确填写</span>
                                        </el-form-item>
                                        <el-form-item class="is-required" label="详细地址" prop="storeInfo.address">
                                            <!-- 详细地址 -->
                                            <el-input v-model="formSubmitData.storeInfo.address"></el-input>
                                        </el-form-item>
                                    </div>
                                    <!-- 身份信息 -->
                                    <h3 class="senter-esinfo__title">身份信息</h3>
                                    <div class="senter-esinfo__body"> 
                                        <el-form-item label="姓名" prop="storeInfo.legalName">
                                            <!-- 身份证姓名 -->
                                            <el-input  v-model="formSubmitData.storeInfo.legalName"></el-input>
                                        </el-form-item>

                                        <el-form-item class="is-required" label="身份证号" prop="storeInfo.legalIdcard">
                                            <!-- 身份证 -->
                                            <el-input v-model="formSubmitData.storeInfo.legalIdcard"></el-input>
                                        </el-form-item>

                                        <el-form-item class="is-required" label="身份证正面" prop="storeInfo.idcardPositivePhoto">
                                            <!-- 身份证正面照 -->
                                            <cms-upload style="display:inline-block" v-model="formSubmitData.storeInfo.idcardPositivePhoto"
                                                :data="{'key':'storeInfo.idcardPositivePhoto','form':'form'}" @change="getImgInfo"></cms-upload>
                                            <span class="input-info input-info--right input-info--right1 ">保证照片上的文字清晰可见</span>
                                        </el-form-item>

                                        <el-form-item class="is-required" label="身份证反面" prop="storeInfo.idcardReversePhoto">
                                            <!-- 身份证反面照片 -->
                                            <cms-upload style="display:inline-block" v-model="formSubmitData.storeInfo.idcardReversePhoto"
                                                :data="{'key':'storeInfo.idcardReversePhoto','form':'form'}" @change="getImgInfo"></cms-upload>
                                            <span class="input-info input-info--right input-info--right1 ">保证照片上的文字清晰可见</span>
                                        </el-form-item>

                                        <el-form-item class="is-required" label="手持身份证照" prop="storeInfo.photo">
                                            <!-- 手持身份证照 -->
                                            <cms-upload style="display:inline-block" v-model="formSubmitData.storeInfo.photo"
                                                :data="{'key':'storeInfo.photo','form':'form'}" @change="getImgInfo"></cms-upload>
                                            <span class="input-info input-info--right input-info--right1 ">保证照片上的文字清晰可见</span><br>
                                            
                                        </el-form-item>
                                        <el-form-item label="">
                                            <img class="handle-photo" src="${res}/images/handidcard.png" alt="">
                                        </el-form-item>
                                    </div>
                                    <!-- 财务信息 -->
                                    <h3 class="senter-esinfo__title">财务信息</h3>
                                    <div class="senter-esinfo__body">
                                        <el-form-item class="verifyid-radio" label="结算账户类型" prop="storeSettlementAccountList.accountType">
                                            <el-radio v-model="formSubmitData.storeSettlementAccountList.accountType"
                                                :label="1">支付宝</el-radio><br>
                                            <span class="input-info">选择实际的结算方式，用于结算周期结束后，平台与商家的结算方式</span>
                                        </el-form-item>

                                        <!-- 支付宝账号 -->
                                        <div v-if="formSubmitData.storeSettlementAccountList.accountType==1">
                                            <el-form-item class="is-required" label="支付宝姓名" prop="storeSettlementAccountList.accountName">
                                                <el-input v-model="formSubmitData.storeSettlementAccountList.accountName"></el-input>
                                            </el-form-item>
                                            <el-form-item class="is-required" label="支付宝账号" prop="storeSettlementAccountList.account">
                                                <el-input v-model="formSubmitData.storeSettlementAccountList.account"></el-input>
                                            </el-form-item>

                                        </div>
                                    </div>
                                    <!-- 按钮 -->
                                    <div class="enter-btn-group">
                                        <a href="${base}/member-storeRegister-store_sign.htm?storeType=1" class="enter-btn-group-prev__link">
                                            <el-button class="enter-btn-group__prev pcolor">
                                                上一步
                                            </el-button>
                                        </a>
                                        <a class="enter-btn-group-next__link" @click.prevent="personStageShop">
                                            <el-button type="primary" class="priColor">
                                                下一步,认证店铺信息
                                            </el-button>
                                        </a>
                                    </div>
                        </el-form>
                    </div>
                    <!-- 店铺信息 -->
                    <div v-if="personStage=='店铺信息'">
                        <el-form size="mini" label-position="right" label-width="150px" :model="formSubmitData" :rules="rules2"
                            ref="form2">
                            <h3 class="senter-esinfo__title">店铺信息</h3>
                            <div class="senter-esinfo__body">
                                <el-form-item class="is-required" label="店铺名称" prop="storeName">
                                    <!-- 店铺名称 -->
                                    <el-input placeholder="名称仅作为参考依据，实际以平台审核为准" v-model="formSubmitData.storeName"></el-input>
                                    <span class="input-info"></span>
                                </el-form-item>
                                <el-form-item class="is-required" label="店铺账号" prop="storeUsername">
                                    <!-- 店铺账号 -->
                            <el-input placeholder="用于登录商家平台账号，不可修改" v-model="formSubmitData.storeUsername"></el-input>
                           
                                    <span class="input-info"></span>
                                </el-form-item>
                                <el-form-item class="is-required" label="密码" prop="pStr">
                                    <!-- 密码 -->
                                    <el-input placeholder="输入6-16位数字及字母组合" type="password" v-model="formSubmitData.pStr"></el-input>
                                    <span class="input-info"></span>
                                </el-form-item>
                                <el-form-item class="is-required" label="确认密码" prop="checkPass">
                                    <!-- 确认密码 -->
                                    <el-input type="password" v-model="formSubmitData.checkPass"></el-input>
                                </el-form-item>
                            </div>
                            <!-- 经营信息 -->
                            <h3 class="senter-esinfo__title">经营信息</h3>
                            <div class="senter-esinfo__body">
                                <el-form-item label="主营类目" prop="saleCateId">
                                    <el-select class="enter-select-option__color" v-model="formSubmitData.saleCateId" placeholder="请选择主营类目">
                                        <el-option v-for="(item,index) in categoryList" :key="item.id" :label="item.cateName" :value="item.id">
                                        </el-option>
                                      </el-select>
                                    <span class="input-info input-info1 input-info2">
                                        店铺经营类目为您申请得店铺所能经营得商品类目，同时涉及到不同的
                                        保证金费用、与平台产生得佣金，平台一经发现您经营得商品与店铺经营
                                        类目不相符，会进行店铺警告，严重者直接进行关闭店铺处理。
                                    </span>
                                </el-form-item>
                            </div>
                            <!-- 按钮 -->
                            <div class="enter-btn-group">
                                <a class="enter-btn-group-prev__link" @click.prevent="personStagePerson">
                                    <el-button class="enter-btn-group__prev pcolor">
                                        上一步
                                    </el-button>
                                </a>
                                <a href="${base}/member-storeRegister-store_exam.htm?storeType=1" @click.prevent="personSubmit"
                                    class="enter-btn-group-next__link">
                                    <el-button type="primary" class="enter-btn-group__next priColor">
                                        下一步,提交审核
                                    </el-button>
                                </a>
                            </div>
                        </el-form>
                    </div>
                </div>
                <!-- 公司表单 -->
                <el-form size="mini" label-position="right" label-width="150px" :model="formSubmitData" :rules="rules"
                    ref="form3">
                    <div v-if="storeType==2">
                        <!-- 公司基本信息 -->
                        <div v-show="companyStage=='公司信息'">
                            <h3 class="senter-esinfo__title">基本信息</h3>
                            <div class="senter-esinfo__body">
                                <el-form-item label="店铺类型">
                                    <span class="store-person">企业店铺</span>
                                </el-form-item>
                                <el-form-item class="is-required" label="公司名称" prop="storeInfo.companyName">
                                    <el-input v-model="formSubmitData.storeInfo.companyName"></el-input>
                                </el-form-item>
                                <el-form-item class="is-required" label="联系人姓名" prop="contactName">
                                    <el-input v-model="formSubmitData.contactName"></el-input>
                                </el-form-item>
                                <el-form-item class="is-required" label="联系人手机" prop="contactMobile">
                                    <el-input placeholder="可用于登录商家平台，请填写常用联系手机" v-model="formSubmitData.contactMobile"></el-input>
                                    <span class="input-info"></span>
                                </el-form-item>
                                <el-form-item class="is-required" label="联系人邮箱" prop="contactMail">
                                    <el-input v-model="formSubmitData.contactMail"></el-input>
                                </el-form-item>
                                <!-- 公司所在地 -->
                                <el-form-item class="companyLoaction" label="公司所在地" prop="storeInfo.areaName">
                                    <cms-area-select class="verifyid-m-select" @change="getAreaInfo" :data="formSubmitData.companyArea"></cms-area-select>
                                    <span class="input-info input-info2">显示在商城店铺，请准确填写</span>
                                </el-form-item>
                                <el-form-item class="is-required" label="详细地址" prop="storeInfo.address">
                                    <el-input v-model="formSubmitData.storeInfo.address"></el-input>
                                </el-form-item>
                                <el-form-item class="is-required" label="公司电话" prop="storeInfo.mobile">
                                    <el-input v-model="formSubmitData.storeInfo.mobile"></el-input>
                                </el-form-item>
                            </div>
                            <!-- 身份信息 -->
                            <h3 class="senter-esinfo__title">营业执照</h3>
                            <div class="senter-esinfo__body">
                                <el-form-item class="is-required" label="营业执照注册号" prop="storeInfo.blNo">
                                    <el-input placeholder="新版三证合一证书，填写机构代码证号" v-model="formSubmitData.storeInfo.blNo"></el-input>
                                    <span class="input-info"></span>
                                </el-form-item>

                                <el-form-item label="营业执照所在地" class=" verifyid-m-select verifyid-m-select-section" prop="storeInfo.blAreaName">
                                    <cms-area-select class="verifyid-m-select" @change="getAreaInfo2" :data="formSubmitData.blArea"></cms-area-select>
                                </el-form-item>
                                <!-- 营业期限 -->
                                <el-form-item class="verifyid-session" label="营业期限" prop="blEndTime">
                                    <el-date-picker v-model="formSubmitData.blEndTime" type="daterange" align="right"
                                        unlink-panels range-separator="至" start-placeholder="开始日期" end-placeholder="结束日期"
                                        value-format="yyyy-MM-dd" @change="getPicker">
                                    </el-date-picker>
                                </el-form-item>
                                <el-form-item class="verifyid-capital is-required" label="注册资本" prop="storeInfo.registeredCapital">
                                    <el-input v-model="formSubmitData.storeInfo.registeredCapital">
                                        <template slot="append">万元</template>
                                    </el-input>

                                </el-form-item>

                                <el-form-item label="成立日期" class="foundTime is-required" prop="storeInfo.setupDate">
                                    <el-date-picker v-model="formSubmitData.storeInfo.setupDate" type="date"
                                        placeholder="选择日期" :picker-options="pickerOptions1" value-format="yyyy-MM-dd">
                                    </el-date-picker>
                                </el-form-item>

                                <el-form-item label="法人姓名" prop="storeInfo.legalName">
                                    <el-input v-model="formSubmitData.storeInfo.legalName"></el-input>
                                </el-form-item>

                                <el-form-item class="is-required" label="法人身份证号" prop="storeInfo.legalIdcard">
                                    <el-input v-model="formSubmitData.storeInfo.legalIdcard"></el-input>
                                </el-form-item>

                                <el-form-item class="is-required" label="法人身份证正面照片" prop="storeInfo.idcardPositivePhoto">
                                    <cms-upload style="display:inline-block" v-model="formSubmitData.storeInfo.idcardPositivePhoto"
                                        :data="{'key':'storeInfo.idcardPositivePhoto','form':'form3'}" @change="getImgInfo"></cms-upload>
                                    <span class="input-info input-info--right input-info--right1">提供身份证正面照，保证照片上的文字清晰可见</span>
                                </el-form-item>

                                <el-form-item class="is-required" label="法人身份证反面照片" prop="storeInfo.idcardReversePhoto">
                                    <cms-upload style="display:inline-block" v-model="formSubmitData.storeInfo.idcardReversePhoto"
                                        :data="{'key':'storeInfo.idcardReversePhoto','form':'form3'}" @change="getImgInfo"></cms-upload>
                                    <span class="input-info input-info--right input-info--right1">提供身份证反面照，保证照片上的文字清晰可见</span>
                                </el-form-item>

                                <el-form-item class="is-required" label="法人手持身份证照" prop="storeInfo.photo">
                                    <cms-upload style="display:inline-block" v-model="formSubmitData.storeInfo.photo"
                                        :data="{'key':'storeInfo.photo','form':'form3'}" @change="getImgInfo"></cms-upload>
                                    <span class="input-info input-info--right input-info--right1">保证照片上的文字清晰可见</span>
                                </el-form-item>
                                <el-form-item label="">
                                    <img class="handle-photo" src="${res}/images/handidcard.png" alt="">
                                </el-form-item>
                                <el-form-item class="is-required" label="营业执照证书" prop="storeInfo.blCert">
                                    <cms-upload style="display:inline-block;" v-model="formSubmitData.storeInfo.blCert"
                                        :data="{'key':'storeInfo.blCert','form':'form3'}" @change="getImgInfo"></cms-upload>
                                    <span class="input-info input-info--right input-info--right1">新版三合一证书亦可，保证照片上的文字清晰可见</span>
                                </el-form-item>
                                <el-form-item class="is-required jyfw" label="经营范围" prop="storeInfo.scopeRange">
                                    <el-input type="textarea" :rows="4" v-model="formSubmitData.storeInfo.scopeRange"></el-input>
                                </el-form-item>
                            </div>
                            <!-- 税务登记 -->
                            <h3 class="senter-esinfo__title">税务登记</h3>
                            <div class="senter-esinfo__body">
                                <el-form-item class="is-required" label="税务登记代码" prop="storeInfo.taxRegistrationCode">
                                    <el-input v-model="formSubmitData.storeInfo.taxRegistrationCode"></el-input>
                                </el-form-item>

                                <el-form-item class="is-required" label="税务登记证" prop="storeInfo.taxRegistrationCert">
                                    <cms-upload style="display:inline-block;" v-model="formSubmitData.storeInfo.taxRegistrationCert"
                                        :data="{'key':'storeInfo.taxRegistrationCert','form':'form3'}" @change="getImgInfo"></cms-upload>
                                </el-form-item>
                            </div>
                            <!-- 财务信息 -->
                            <h3 class="senter-esinfo__title">财务信息</h3>
                            <div class="senter-esinfo__body">
                                <el-form-item class="verifyid-radio" label="结算账户类型" prop="storeSettlementAccountList.accountType">
                                    <el-radio v-model="formSubmitData.storeSettlementAccountList.accountType" :label="1">支付宝</el-radio><br>
                                    <span class="input-info">选择实际的结算方式，用于结算周期结束后，平台与商家的结算方式</span>
                                </el-form-item>
                                <!-- 支付宝账号 -->
                                <div v-if="formSubmitData.storeSettlementAccountList.accountType==1">
                                    <el-form-item class="is-required" label="支付宝姓名" prop="storeSettlementAccountList.accountName">
                                        <el-input v-model="formSubmitData.storeSettlementAccountList.accountName"></el-input>
                                    </el-form-item>
                                    <el-form-item class="is-required" label="支付宝账号" prop="storeSettlementAccountList.account">
                                        <el-input v-model="formSubmitData.storeSettlementAccountList.account"></el-input>
                                    </el-form-item>
                                </div>
                            </div>
                            <!-- 公司按钮 -->
                            <div class="enter-btn-group">
                                <a href="${base}/member-storeRegister-store_sign.htm?storeType=2" class="enter-btn-group-prev__link">
                                    <el-button class="enter-btn-group__prev">
                                        上一步
                                    </el-button>
                                </a>
                                <a class="enter-btn-group-next__link" @click.prevent="enterStageShop">
                                    <el-button type="primary" class="enter-btn-group__next priColor">
                                        下一步,认证店铺信息
                                    </el-button>
                                </a>
                            </div>
                </el-form>
            </div>
            <!-- 店铺基本信息 -->
            <div v-if="companyStage=='店铺信息'">
                <el-form size="mini" label-position="right" label-width="150px" :model="formSubmitData" :rules="rules2"
                    ref="form4">
                    <h3 class="senter-esinfo__title">基本信息</h3>
                    <div class="senter-esinfo__body">
                        <el-form-item class="is-required" label="店铺名称" prop="storeName">
                            <el-input v-model="formSubmitData.storeName" placeholder="名称仅作为参考依据，实际以平台审核为准"></el-input>
                            <span class="input-info">
                            </span>
                        </el-form-item>
                        <el-form-item class="is-required" label="店铺账号" prop="storeUsername">
                            <el-input placeholder="用于登录商家平台账号，不可修改" v-model="formSubmitData.storeUsername"></el-input>
                            <span class="input-info"></span>
                        </el-form-item>
                        <el-form-item class="is-required" label="密码" prop="pStr">
                            <el-input placeholder="输入6-16位数字及字母组合" type="password" v-model="formSubmitData.pStr"></el-input>
                            <span class="input-info"></span>
                        </el-form-item>
                        <el-form-item class="is-required" label="确认密码" prop="checkPass">
                            <el-input type="password" v-model="formSubmitData.checkPass"></el-input>
                        </el-form-item>

                    </div>
                    <!-- 经营信息 -->
                    <h3 class="senter-esinfo__title">经营信息</h3>
                    <div class="senter-esinfo__body">
                        <el-form-item label="主营类目" prop="saleCateId">
                            <el-select class="enter-select-option__color" v-model="formSubmitData.saleCateId" placeholder="请选择主营类目">
                                <el-option v-for="(item,index) in categoryList" :key="item.id" :label="item.cateName" :value="item.id">
                                </el-option>
                              </el-select>
                            <span class="input-info input-info1 input-info2">
                                店铺经营类目为您申请得店铺所能经营得商品类目，同时涉及到不同的
                                保证金费用、与平台产生得佣金，平台一经发现您经营得商品与店铺经营
                                类目不相符，会进行店铺警告，严重者直接进行关闭店铺处理。
                            </span>
                        </el-form-item>
                    </div>
                    <!-- 店铺按钮 -->
                    <div class="enter-btn-group">
                        <a class="enter-btn-group-prev__link" @click.prevent="enterStageCompany">
                            <el-button class="enter-btn-group__prev">
                                上一步
                            </el-button>
                        </a>
                        <a href="${base}/member-storeRegister-store_exam.htm?storeType=2" class="enter-btn-group-next__link">
                            <el-button type="primary" class="enter-btn-group__next priColor" @click.prevent="personSubmit">
                                下一步,提交审核
                            </el-button>
                        </a>
                    </div>
                </el-form>
            </div>
        </div>
    </div>
</body>

</html>


<script>
    var areaData = {
        province: {
            areaCode: "",
            areaName: ""
        },
        city: {
            areaCode: "",
            areaName: "",

        },
        area: {
            areaCode: "",
            areaName: ""
        }
    }
    var app = new Vue({
        el: '#main',
        data() {
            //个人信息
            var self = this
            //验证联系人手机
            var validateContactMobile = function (rule, value, callback) {
                var patrnMobile = /^1(3|4|5|7|8)\d{9}$/
                if (value === '') {
                    callback(new Error('请输入手机号'))
                } else {
                    if (!patrnMobile.test(value)) {
                        callback(new Error('手机格式不正确'))
                    } else {
                        cms.ajax({
                            url: '${base}/member/enterstore/validPhone',
                           
                            data: {
                                validPhone: value,
                                id:self.formSubmitData.id
                            }
                        }, function (res) {
                            if (res.data) {
                                callback()
                            } else {
                                callback(new Error('该手机号已注册店铺'))
                            }
                        })
                    }
                }
            };
            //验证联系人邮箱
            var validateContactMail = function (rule, value, callback) {
                var patrnEmail =
                    /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/
                if (value === '') {
                    callback(new Error('请输入邮箱'));
                } else {
                    if (!patrnEmail.test(value)) {
                        callback(new Error('邮箱格式不正确'))
                    } else {
                        cms.ajax({
                            url: '${base}/member/enterstore/validContactMail',             
                            data: {
                                validContactMail: value,
                                id:self.formSubmitData.id
                            }
                        }, function (res) {
                            if (res.data) {
                                callback()
                            } else {
                                callback(new Error('该邮箱已注册店铺'))
                            }
                        })
                    }
                }
            };
            //验证身份证
            var validateLegalIdcard = function (rule, value, callback) {
                var patrnIdcard =
                    /^[1-9]\d{7}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}$|^[1-9]\d{5}[1-9]\d{3}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}([0-9]|X)$/;
                if (value === '') {
                    callback(new Error('请填写身份证'));
                } else {
                    if (!patrnIdcard.test(value)) {
                        callback(new Error('身份证格式错误'));
                    } else {
                        cms.ajax({
                            url: '${base}/member/enterstore/validIdcard',                 
                            data: {
                                validIdcard: value,
                                id:self.formSubmitData.id
                            }
                        }, function (res) {
                            if (res.data) {
                                callback();
                            } else {
                                callback(new Error('该身份证已注册店铺'));
                            }
                        })
                    }
                }
            };
            //验证店铺名称
            var validateStoreName = function (rule, value, callback) {
                if (value === '') {
                    callback(new Error('请输入店铺名称'));
                } else {
                    cms.ajax({
                        url:'${base}/member/enterstore/validName',                     
                        data: {
                            validName: value,
                            id:self.formSubmitData.id
                        }
                    }, function (res) {
                        if (res.data) {
                            callback();
                        } else {
                            callback(new Error('该店铺名称已存在'));
                        }
                    })
                }
            };
            //验证店铺账号
            var validateStoreUsername = function (rule, value, callback) {
                if (value === '') {
                    callback(new Error('请输入店铺账号'));
                } else {
                    cms.ajax({
                        url: '${base}/member/enterstore/validUsername',
                        data: {
                            validUsername: value,
                            id:self.formSubmitData.id
                        }
                    }, function (res) {
                        if (res.data) {
                            callback();
                        } else {
                            callback(new Error('该店铺账号已存在'));
                        }
                    })
                }
            };
            //验证输入密码
            var validatePass = function (rule, value, callback) {
                var patrnPass = /^[a-zA-Z\d]+$/
                var patrnCh = /^[u4e00-u9fa5]*$/
                if (value === '') {
                    callback(new Error('请输入密码'))
                } else {
                    if (!patrnPass.test(value) && !patrnPass.test(value)) {
                        callback(new Error('只能输入数字和大小写字母'))
                    } else {
                        callback()
                    }

                }
            };
            //验证确认密码
            var validateCheckPass = function (rule, value, callback) {
                if (value === '') {
                    callback(new Error('请再次输入密码'))
                } else if (value !== self.formSubmitData.pStr) {
                    callback(new Error('两次输入密码不一致'));
                } else {
                    callback();
                }
            };
            //验证公司电话
            var validatePhone = function (rule, value, callback) {
                var patrnPhone = /^[0][1-9]{2,3}-[0-9]{7,8}$/
                var patrnMobile = /^1(3|4|5|7|8)\d{9}$/
                if (value === '') {
                    callback(new Error('请输入公司电话'))
                }else if (!patrnPhone.test(value) && !patrnMobile.test(value)) {
                    callback(new Error('公司电话格式不正确'));
                } else {
                    callback();
                }
            };
            //验证营业执照注册号
            var validateBlNo = function (rule, value, callback) {
                var patrnBlNo = /^[0-9]*$/
                if (value === '') {
                    callback(new Error('请输入营业执照注册号'))
                }
                if (!patrnBlNo.test(value)) {
                    callback(new Error('营业执照注册号必须为数字'))
                } else {
                    cms.ajax({
                        url: '${base}/member/enterstore/validBlNo',
                        data: {
                            validBlNo: value,
                            id:self.formSubmitData.id
                        }
                    }, function (res) {
                        if (res.data) {
                            callback()
                        } else {
                            callback(new Error('该营业执照注册号已注册店铺'))
                        }
                    })
                }
            };
            //验证税务登记代码
            var validateRegCode = function (rule, value, callback) {
                var patrnBlNo = /^[0-9]*$/
                if (value === '') {
                    callback(new Error('请输入税务登记代码'))
                }
                if (!patrnBlNo.test(value)) {
                    callback(new Error('税务登记代码必须为数字'))
                } else {
                    callback();
                }
            };
            //验证注册资本
            var validateRegMoney = function (rule, value, callback) {
                var patrnRegMoney = /^[1-9]{1}[0-9]{0,9}(.[0-9]{0,2})?$/
                if (value === '') {
                    callback(new Error('请输入注册资本'))
                } else {
                    if (isNaN(value)) {
                        callback('金额必须为数字')
                    }
                    if (!patrnRegMoney.test(value)) {
                        callback(new Error('正整数位最多10位，小数位最多两位'))
                    } else {
                        callback();
                    }
                }
            };
            //验证联系人姓名
            var validateRegName = function (rule, value, callback) {
                var patrnName = /^[\u4E00-\u9FA5A-Za-z]+$/;
                if (value === '') {
                    callback(new Error('请输入联系人姓名'))
                }
                if (!patrnName.test(value)) {
                    callback(new Error('姓名不规范'))
                } else {
                    callback();
                }
            };
            return {
                areaData: JSON.parse(JSON.stringify(areaData)), //临时存储编辑的省市信息
                personStage: '个人信息',
                companyStage: '公司信息',
                locatHref: '',
                patt: /\?[a-zA-Z0-9=]+/,
                storeType: '',
                /* 1：个人 2：企业 */
                value: '',
                /* 主营类目默认选项 */
                pickerOptions1: {
                    disabledDate(time) {
                        return time.getTime() > Date.now();
                    },
                },
                dataSelectValue: '',
                rules: {
                    'contactName': [{
                        required: true,
                        validator: validateRegName,
                        trigger: 'blur'
                    }, {
                        max: 15,
                        message: '用户名过长',
                        trigger: 'blur'
                    }],
                    'contactMobile': [{
                        required: true,
                        validator: validateContactMobile,
                        trigger: 'blur'
                    }],
                    'contactMail': [{
                        required: true,
                        validator: validateContactMail,
                        trigger: 'blur'
                    }, {
                        min: 6,
                        max: 50,
                        message: '邮箱字符在6-50之间',
                        trigger: 'blur'
                    }],
                    'storeInfo.legalName':[{
                        required: true,
                        validator: validateRegName,
                        trigger: 'blur'
                    }, {
                        min: 2,
                        max: 15,
                        message: '用户名在2-15个字符之间',
                        trigger: 'blur'
                    }],
                    'storeInfo.address': [{
                        required: true,
                        message: '请输入详细地址',
                        trigger: 'blur'
                    }, {
                        max: 50,
                        message: '地址长度过长',
                        trigger: 'blur'
                    }],
                    'storeInfo.companyName': [{
                        required: true,
                        message: '请输入公司名称',
                        trigger: 'blur'
                    }, {
                        max: 25,
                        message: '公司名称过长',
                        trigger: "blur"
                    }],
                    'storeInfo.blNo': [{
                        required: true,
                        validator: validateBlNo,
                        trigger: 'blur'
                    }, {
                        min: 15,
                        max: 15,
                        message: '值为长度15个字符',
                        trigger: 'blur'
                    }],
                    'blEndTime': [{
                        required: true,
                        message: '此项必填',
                        trigger: 'change'
                    }],
                    'storeInfo.mobile': [{
                        required: true,
                        validator: validatePhone,
                        trigger: 'blur'
                    }, {
                        min: 5,
                        max: 15,
                        message: '电话长度为5-15个字符',
                        trigger: 'blur'

                    }],
                    'storeInfo.registeredCapital': [{
                        required: true,
                        validator: validateRegMoney,
                        trigger: 'blur'
                    }],
                    'storeInfo.legalIdcard': [{
                        required: true,
                        validator: validateLegalIdcard,
                        trigger: 'blur'
                    }],
                    'storeInfo.idcardPositivePhoto': [{
                        required: true,
                        message: '请上传身份证正面照',
                        trigger: 'change'
                    }],
                    'storeInfo.idcardReversePhoto': [{
                        required: true,
                        message: '请上传身份证反面照',
                        trigger: 'blur'
                    }],
                    'storeInfo.photo': [{
                        required: true,
                        message: '请上传手持身份证照',
                        trigger: 'blur'
                    }],
                    'storeSettlementAccountList.accountType': [{
                        required: true,
                        message: '此项必填',
                        trigger: "blur"
                    }],
                    'storeInfo.blCert': [{
                        required: true,
                        message: '此项必填',
                        trigger: 'blur'
                    }],
                    'storeInfo.scopeRange': [{
                        required: true,
                        message: '此项必填',
                        trigger: 'blur'
                    }, {
                        max: 100,
                        message: '经营范围过长',
                        trigger: 'blur'
                    }],
                    'storeInfo.setupDate': [{
                        required: true,
                        message: '此项必填',
                        trigger: 'blur'
                    }],
                    'storeInfo.taxRegistrationCert': [{
                        required: true,
                        message: '此项必填',
                        trigger: 'blur'
                    }],
                    'storeInfo.taxRegistrationCode': [{
                        required: true,
                        validator: validateRegCode,
                        trigger: 'blur'
                    }, {
                        min: 15,
                        max: 15,
                        message: '长度为15个字符',
                        trigger: 'blur'
                    }],
                    'storeSettlementAccountList.bankName': [{
                        required: true,
                        message: '请输入开户行姓名',
                        trigger: 'blur'
                    }, {
                        min: 4,
                        max: 15,
                        message: '开户银行字符在4-15个字符之间',
                        trigger: 'blur'
                    }],
                    'storeSettlementAccountList.account': [{
                        required: true,
                        message: '请输入支付宝账号',
                        trigger: 'blur'
                    },{
                        max:30,
                        message:'支付宝账号过长',
                        trigger:'blur'
                    }],
                    'storeSettlementAccountList.accountName': [{
                        required: true,
                        message: '请输入支付宝姓名',
                        trigger: 'blur'
                    }, {
                        max: 20,
                        message: '支付宝姓名过长',
                        trigger: 'blur'
                    }],
                    'storeInfo.areaName': [{
                        required: true,
                        message: '此项必填',
                        trigger: 'change'
                    }],
                    'storeInfo.blAreaName': [{
                        required: true,
                        message: '此项必填',
                        trigger: 'change'
                    }],
                },
                rules2: {
                    'storeName': [{
                        required: true,
                        validator: validateStoreName,
                        trigger: 'blur'
                    }, {
                        max: 25,
                        message: '店铺名称过长',
                        trigger: 'blur'
                    }],
                    'storeUsername': [{
                        required: true,
                        validator: validateStoreUsername,
                        trigger: 'blur'
                    }, {
                        max: 15,
                        message: '店铺账号过长',
                        trigger: 'blur'
                    }],
                    'pStr': [{
                        required: true,
                        validator: validatePass,
                        trigger: 'blur'
                    }, {
                        min: 6,
                        max: 16,
                        message: '长度在6到16个字符之间',
                        trigger: 'blur'
                    }],
                    'checkPass': [{
                        required: true,
                        validator: validateCheckPass,
                        trigger: 'blur'
                    }],
                    'saleCateId': [{
                        required: true,
                        message: '此项不能为空',
                        trigger: 'change'
                    }]

                },
                categoryList: [],
                formSubmitData: { /* 提交的数据 */
                    "id":'',
                    "storeType": 1,
                    /* 1个人 2企业 数字*/
                    "contactName": "",
                    /* 联系人姓名 */
                    "contactMobile": "",
                    /* 联系人电话 */
                    "contactMail": "",
                    /* 邮箱 */
                    storeInfo: {
                        "legalName": "",
                        /* 身份证姓名 */
                        "legalIdcard": "",
                        /* 身份证 数字*/
                        "idcardPositivePhoto": "",
                        /* 身份证正面照 */
                        "idcardReversePhoto": "",
                        /* 身份证反面照 */
                        "photo": "",
                        /* 法人手持身份证照；个人店铺手持身份证照 */
                        "provinceName": "",
                        /* 省级名称 */
                        "provinceCode": "",
                        /* 省级代号 */
                        "blProvinceName": "",
                        /* 营业执照所在省级名称 */
                        "blProvinceCode": "",
                        /* 营业执照所在省级代号 */
                        "cityName": "",
                        /* 城市名称 */
                        "cityCode": "",
                        /* 城市代号 */
                        "blCityName": "",
                        /* 营业执照所在市级名称 */
                        "blCityCode": "",
                        /* 营业执照所在市级代号 */
                        "areaName": "",
                        /* 县级地区名称 */
                        "areaCode": "",
                        /* 县级地区代号 */
                        "blAreaName": "",
                        /* 营业执照所在区级名称 */
                        "blAreaCode": "",
                        /* 营业执照所在区级代号 */
                        "blStartTime": "",
                        /* 营业期限开始时间 */
                        "blEndTime": "",
                        /* 营业期限结束时间 */
                        "setupDate": "",
                        /* 成立日期 */
                        "address": "",
                        /* 地址 */
                        "companyName": "",
                        /* 公司名称 */
                        "mobile": "",
                        /* 公司电话 */
                        "blNo": "",
                        /* 营业执照注册号 */
                        "blCert": "",
                        /* 营业执照证书 */
                        "registeredCapital": "",
                        /* 注册资本 */
                        "scopeRange": "",
                        /* 经营范围 */
                        "taxRegistrationCode": "",
                        /* 税务登记代码 */
                        "taxRegistrationCert": "",
                        /* 税务登记证 */
                    },
                    storeSettlementAccountList: {
                        "accountType": 1,
                        /* 账户类型 1-银联 2-支付宝 3-微信 数字*/
                        "account": "",
                        /* 账户 */
                        "accountName": "",
                        /* 姓名 */
                        "bankName": "",
                        /* 开户行 */
                    },
                    "storeName": "",
                    /* 店铺名称 */
                    "storeUsername": "",
                    /* 店铺账户 */
                    "pStr": "",
                    /* 密码 */
                    "checkPass": "",
                    /*  确认密码 */
                    "saleCateId": '',
                    /* 主营类目ID 数字*/
                }
            };
        },
        watch: {
        
        },
        methods: {
            getAreaInfo(data) { //获取省市区地址
                let select = this.formSubmitData.storeInfo;
                select.provinceName = data.province.areaName,
                    select.provinceCode = data.province.areaCode,
                    select.cityName = data.city.areaName,
                    select.cityCode = data.city.areaCode,
                    select.areaName = data.area.areaName,
                    select.areaCode = data.area.areaCode
            },
            getAreaInfo2(data) { //获取营业执照所在省市区地址
                let select = this.formSubmitData.storeInfo;
                select.blProvinceName = data.province.areaName,
                    select.blProvinceCode = data.province.areaCode,
                    select.blCityName = data.city.areaName,
                    select.blCityCode = data.city.areaCode,
                    select.blAreaName = data.area.areaName,
                    select.blAreaCode = data.area.areaCode
            },
            getPicker(data) {
                this.formSubmitData.storeInfo.blStartTime = data[0] //返回营业执照开始时间
                console.log(this.formSubmitData.storeInfo.blStartTime)
                this.formSubmitData.storeInfo.blEndTime = data[1] //返回营业执照结束时间
                console.log(this.formSubmitData.storeInfo.blEndTime)

            },
            /* 个人方法 */
            personStageShop() {
                var that = this
                this.$refs['form'].validate(function (valid, data) {
                    if (valid) {
                        that.personStage = '店铺信息',
                            window.scrollTo(0, 0)
                    } else {
                        return false
                    }
                })
            },
            personStagePerson() {
                this.personStage = '个人信息',
                    window.scrollTo(0, 0)
            },
            /* 公司方法 */
            enterStageShop() {
                var that = this
                this.$refs['form3'].validate(function (valid) {
                    console.log(valid)
                    if (valid) {
                        that.companyStage = '店铺信息',
                            that.personStage = '店铺信息',
                            window.scrollTo(0, 0)
                    } else {
                        return false
                    }
                })
            },
            enterStageCompany() {
                this.companyStage = '公司信息',
                    this.personStage = '个人信息',
                    window.scrollTo(0, 0)
            },
            getImgInfo(data, obj) { //这里可以自定义上传的验证，第一个参数图片的资源，第二个自定义的对象
                this.$refs[obj.form].validateField(obj.key) //重置验证

            },
            /* 取得分类信息 */
            getCategorydata() {
                var that = this
                cms.ajax({
                    url: '${base}/productcategory/list',
                }, function (res) {
                    if (res.code == 200) {
                        that.categoryList = res.data
                    } else {
                        cms.alert(res.message,5)
                    }
                })
            },
            /* 个人信息店铺信息提交 */
            personSubmit() {
                let formData = JSON.parse(JSON.stringify(this.formSubmitData))
                formData.pStr = encrypt(formData.pStr)
                if (formData.storeType == 1) {
                    this.$refs['form2'].validate(function (valid) {
                        if (valid) {
                            cms.ajax({
                                url: '${base}/member/enterstore/save',
                                type: "post",
                                data: JSON.stringify(formData)
                            }, function (res) {
                                if (res.code == 200) {
                                    cms.alert('提交审核成功',4)
                                    location.href="${base}/member-storeRegister-storeSettledIn.htm"
                                } else {
                                    cms.alert(res.message,5)
                                }
                            })
                        } else {
                            return false
                        }
                    })
                }
                if (formData.storeType == 2) {
                    this.$refs['form4'].validate(function (valid) {
                        if (valid) {
                            cms.ajax({
                                url: cms.url + '${base}/member/enterstore/save',
                                type: "post",
                                data: JSON.stringify(formData)
                            }, function (res) {
                                if (res.code == 200) {
                                    cms.alert('提交审核成功',4)
                                    location.href="${base}/member-storeRegister-storeSettledIn.htm"
                                } else {
                                    cms.alert(res.message,5)
                                }
                            })
                        } else {
                            return false
                        }
                    })
                }
            },
             setCompanyData(data){//处理公司类型数据显示
                //公司地址
                this.formSubmitData.companyArea = {
                        province: {
                            areaCode: data.storeInfo.provinceCode,
                            areaName: data.storeInfo.provinceName
                        },
                        city: {
                            areaCode: data.storeInfo.cityCode,
                            areaName: data.storeInfo.cityName,
                        },
                        area: {
                            areaCode: data.storeInfo.areaCode,
                            areaName: data.storeInfo.areaName
                        }
                    }
                   //营业执照所在地
                    this.formSubmitData.blArea = {
                        province: {
                            areaCode: data.storeInfo.blProvinceCode,
                            areaName: data.storeInfo.blProvinceName
                        },
                        city: {
                            areaCode: data.storeInfo.blCityCode,
                            areaName: data.storeInfo.blCityName,
                        },
                        area: {
                            areaCode: data.storeInfo.blAreaCode,
                            areaName: data.storeInfo.blAreaName
                        }
                    }
                    //营业期限
                    this.formSubmitData.blEndTime=[
                       this.formatTime(data.storeInfo.blStartTime),
                       this.formatTime(data.storeInfo.blEndTime)
                    ]
                    //成立日期
                    this.formSubmitData.storeInfo.setupDate= this.formatTime(data.storeInfo.setupDate)
             },
            getFormInfo() {
                let self = this
                cms.ajax({
                    url: "${base}/member/enterstore/get"
                }, function (res) {
                    self.formSubmitData = res.data
                    self.formSubmitData.storeSettlementAccountList = 
                    res.data.storeSettlementAccountList[0]
                    //公司所在地
                   if(res.data.storeType==2){//公司类型
                    self.setCompanyData(res.data) 
                   }    
                })
            },
            formatTime(timeStr) {  //调整时间的方法
                return moment(parseInt(timeStr)).format('YYYY-MM-DD')
            },
        },
        created() {
            /* 获取链接里传递的数据 */
            this.getCategorydata()
            this.storeType = '${storeType!}'
            this.formSubmitData.storeType = parseInt(this.storeType)
            if ('${type!}' === 'update') { //判断是否是修改
                this.getFormInfo()
            }
        },
    });
</script>
